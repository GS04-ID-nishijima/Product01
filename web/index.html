<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/lib/bootstrap/bootstrap.min.js"></script>
    <script src="js/lib/slick/slick.min.js"></script>
    <script src="js/main.js"></script>
    <link rel="stylesheet" href="css/lib/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="css/lib/slick/slick-theme.css">
    <link rel="stylesheet" href="css/lib/slick/slick.css">
    <link rel="stylesheet" href="css/lib/lightbox/lightbox.min.css">
    <link rel="stylesheet" href="css/marche.css">
    <title>Favorite Marche - 今日もマルシェに出掛けよう</title>
</head>

<body>
    <header>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="header-title">Favorite Marche</h2>
                </div>
            </div>
        </div>
    </header>
    <div>
        <div class="container">
            <div class="row hostinfo-row">
                <div class="col-md-4 hostinfo-col col-md-push-8">
                    <ul class="nav nav-pills nav-justified">
                        <li class="active"><a href="#hostinfo_list_oneweek" data-toggle="pill">1週間以内</a></li>
                        <li><a href="#hostinfo_list_all" data-toggle="pill">すべて</a></li>
                    </ul>
                    <div class="hostinfo-list hidden-xs hidden-sm tab-content">
                       <div id="hostinfo_list_oneweek" class="tab-pane active">
                            <div class="hostinfo-date-header">
                                <span class="hostinfo-date">7月14日（土）開催</span>
                            </div>
                            <div class="hostinfo-space"></div>
                            <div class="hostinfo-card">
                                <p>
                                    <a href="javascript:hostinfolist_click(0)" class="hostinfo-name">Farmer's Market</a>
                                </p>
                                <div class="clearfix">
                                    <img src="../photo/sample_01.jpg" alt="開催団体" class="hostinfo-photo">
                                    <ul class="hostinfo-contents">
                                        <li>青山・国際連合大学前広場</li>
                                        <li>出店規模：30店</li>
                                        <li>青山パン祭り開催</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="hostinfo-space"></div>
                            <div class="hostinfo-card">
                                <p>
                                    <a href="#" class="hostinfo-name">Farmer's Market</a>
                                </p>
                                <div class="clearfix">
                                    <img src="../photo/sample_01.jpg" alt="開催団体" class="hostinfo-photo">
                                    <ul class="hostinfo-contents">
                                        <li>青山・国際連合大学前広場</li>
                                        <li>出店規模：30店</li>
                                        <li>青山パン祭り開催</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="hostinfo-space"></div>

                            <div class="hostinfo-date-header">
                                <span class="hostinfo-date">7月15日（日）開催</span>
                            </div>
                            <div class="hostinfo-space"></div>
                            <div class="hostinfo-card">
                                <p>
                                    <a href="#" class="hostinfo-name">Farmer's Market</a>
                                </p>
                                <div class="clearfix">
                                    <img src="../photo/sample_01.jpg" alt="開催団体" class="hostinfo-photo">
                                    <ul class="hostinfo-contents">
                                        <li>青山・国際連合大学前広場</li>
                                        <li>出店規模：30店</li>
                                        <li>青山パン祭り開催</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="hostinfo-space"></div>
                            <div class="hostinfo-card">
                                <p>
                                    <a href="#" class="hostinfo-name">Farmer's Market</a>
                                </p>
                                <div class="clearfix">
                                    <img src="../photo/sample_01.jpg" alt="開催団体" class="hostinfo-photo">
                                    <ul class="hostinfo-contents">
                                        <li>青山・国際連合大学前広場</li>
                                        <li>出店規模：30店</li>
                                        <li>青山パン祭り開催</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div id="hostinfo_list_all" class="tab-pane">
                            <div class="hostinfo-date-header">
                                <span class="hostinfo-date">7月14日（土）開催</span>
                            </div>
                            <div class="hostinfo-space"></div>
                            <div class="hostinfo-card">
                                <p>
                                    <a href="javascript:hostinfolist_click(0)" class="hostinfo-name">Farmer's Market</a>
                                </p>
                                <div class="clearfix">
                                    <img src="../photo/sample_01.jpg" alt="開催団体" class="hostinfo-photo">
                                    <ul class="hostinfo-contents">
                                        <li>青山・国際連合大学前広場</li>
                                        <li>出店規模：30店</li>
                                        <li>青山パン祭り開催</li>
                                    </ul>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="col-md-8 hostinfo-col col-md-pull-4">
                    <div id="hostinfomap" class="border-solid map-col">
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="latest-photo-col border-solid">
                        <p class="latest-photo-title">最近アップロードされた写真</p>
                        <div class="top-carousel-box">
                            <div class="top-carousel">
                                <div>
                                    <p><a href="../photo/sample_02.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_02.jpg" alt="02" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ1</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_03.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_03.jpg" alt="03" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ2</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_04.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_04.jpg" alt="04" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ3</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_05.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_05.jpg" alt="05" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ4</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_06.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_06.jpg" alt="06" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ5</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_07.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_07.jpg" alt="07" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ6</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_01.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_01.jpg" alt="08" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ7</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_02.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_02.jpg" alt="09" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ8</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_03.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_03.jpg" alt="10" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ9</span></p>
                                </div>
                                <div>
                                    <p><a href="../photo/sample_04.jpg" data-lightbox="latest-photo-group"><img src="../photo/sample_04.jpg" alt="11" class="top-carousel-photo"></a></p>
                                    <p class="top-carousel-comment"><span class="top-carousel-comment-text">今日おすすめ10</span></p>
                                </div>
                            </div>
                        </div>
                     </div>
                </div>
            </div>
        </div>
        <footer>
            <div class="container">
                <div class="row footer-row">
                    <div class="footer-col col-md-6">
                       <div class="footer-contents1">
                        <span class="footer-title">Favorite Marche</span>
                        <span class="footer-inquiry"><a href="#">お問い合わせ</a></span>
                       </div>
                    </div>
                    <div class="footer-col col-md-6 copyright">
                       <div class="footer-contents2">
                        ©2016 Favorite Marche All Rights Reserved.
                       </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

<script>
$(document).ready(function(){
    // カルーセル対応
    $('.top-carousel').slick({
        infinite: false,
        slidesToShow: 5,
        slidesToScroll: 3,
        infinite: true,
        responsive: [
            {
              breakpoint: 1210,
              settings: {
                slidesToShow: 4,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 982,
              settings: {
                slidesToShow: 3,
                slidesToScroll: 2
              }
            },
            {
              breakpoint: 730,
              settings: {
                slidesToShow: 2,
                slidesToScroll: 1
              }
            },
            {
              breakpoint: 360,
              settings: {
                slidesToShow: 1,
                slidesToScroll: 1
              }
            }
        ]
    });
});

var dispInfoWindow;
var marcheMap;

// google Map 情報ウィンドウ表示
function attachMessage(marker, msg) {
    google.maps.event.addListener(marker, 'click', function(evnt) {
        if(dispInfoWindow) dispInfoWindow.close();
        dispInfoWindow = new google.maps.InfoWindow({
            content: msg
        });
        dispInfoWindow.open(marker.getMap(), marker);
    })
};

// Map初期化
function initMap() {
    // 初期表示地、仮
    var lat = 35.662107;
    var lon = 139.718568;

    marker_list = new google.maps.MVCArray();

    // #hostinfomap「GoogleMap」化
    marcheMap = new google.maps.Map(document.getElementById('hostinfomap'), {
       center: {lat: lat, lng: lon},
       zoom: 14
    });

    var data = new Array();
    var infoWindowText = '<p><a href="http://localhost/Product01/web/index.html" class="hostinfo-name">Farmer\'s Market</a></p><ul class="infoWindow-ul"><li>青山・国際連合大学前広場</li><li>出店規模：約35(キッチンカー含む)</li><li>青山パン祭り開催</li></ul>';
    data.push({
        position: new google.maps.LatLng(35.661883, 139.707970),
        content: infoWindowText});
    var infoWindowText = '<p><a href="http://localhost/Product01/web/index.html" class="hostinfo-name">ヒルズマルシェ</a></p><ul class="infoWindow-ul"><li>アーク・カラヤン広場</li><li>出店規模：約30(キッチンカー含む)</li></ul>';
    data.push({
        position: new google.maps.LatLng(35.666680, 139.740340),
        content: infoWindowText});

    for(i = 0; i < data.length; i++){
        var marker = new google.maps.Marker({
            position: data[i].position,
            map: marcheMap
        });
        marker_list[i] = marker;
        attachMessage(marker, data[i].content);
    }
};

// 開催情報クリック
function hostinfolist_click(i){
    google.maps.event.trigger(marker_list[i], "click");
};

// 開催情報取得
$('a[data-toggle="pill"]').on('shown.bs.tab', function (e) {

    var id = $(e.target).attr("href");
    var withinOneWeekMode;
    var bounds = marcheMap.getBounds();

    if(id === '#hostinfo_list_oneweek') {
        withinOneWeekMode = '1';
    } else if(id === '#hostinfo_list_all') {
        withinOneWeekMode = '2';
    }

    var send_data;
    send_data = {
        mode : '1',
        withinOneWeekMode : withinOneWeekMode,
        startingPointLatitude : bounds.getSouthWest().lat(),
        startingPointLongitude : bounds.getSouthWest().lng(),
        endPointLatitude : bounds.getNorthEast().lat(),
        endPointLongitude : bounds.getNorthEast().lng()
    };

    var requet = $.ajax({
        type: 'GET',
        url: '../api/v1/hostinfolist.php',
        cashe: false,
        dataType: "json",
        data: send_data,
        timeout: 10000
    });
    requet.done(function(responseList){
//        console.dir(responseList);
        for(key1 in responseList){
//            console.dir(responseList[key]);
            console.log(responseList[key1].holdingDateYmd);
            console.log(formatHostinfoDate(responseList[key1].holdingDateYmd));
            for(key2 in responseList[key1].hostList){
                console.dir(responseList[key1].hostList[key2]);
            }
//            console.dir(responseList[key].hostList);
        }
//        $.getJSON(response, function(data){
//            $(data).each(function(){
//                         console.dir(data);
//                         })
//        })
//        $('div[data-result=""]').html(JSON.stringify(response));
//        return false;
    });
    requet.fail(function(XMLHttpRequest, textStatus, errorThrown) {
        console.log('fail');
        console.log(XMLHttpRequest);
        console.log(textStatus);
        console.log(errorThrown);
    });

});

</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDzNXQMNe9MNNjRc6Ey4Eg-exdJymnaj-w&callback=initMap"></script>
<script src="js/lib/lightbox/lightbox.min.js"></script>
</body>
</html>